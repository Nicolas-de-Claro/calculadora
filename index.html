<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Calculadora de precios para planes de Internet, TV y l칤neas m칩viles" />
  <meta name="theme-color" content="#D32F2F" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Calculadora de Precios</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192x192.png" />
  <link rel="icon" type="image/png" href="icons/icon-192x192.png" />
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <!-- Chart.js for pie chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body>
  <div class="main-container">
    <header class="header" role="banner">
      <h1 id="page-title">Calculadora de Precios</h1>
      <div class="header-buttons">
        <button id="theme-toggle-btn" class="theme-toggle-btn" aria-label="Cambiar tema">游깿</button>
        <button id="config-btn" class="config-btn" aria-label="Abrir configuraci칩n de precios">丘뙖잺</button>
      </div>
    </header>

    <!-- Tab: Calculadora -->
    <main id="tab-calculadora" class="tab-content active" role="tabpanel">
      <!-- Card de Internet y TV -->
      <div class="card">
        <h2 class="card-title">Internet y TV</h2>
        <div class="option">
          <label for="baf-type">Tipo de Plan</label>
          <select id="baf-type">
            <option value="RESIDENCIAL">BAF Residencial</option>
            <option value="IP_DINAMICA">BAF IP Din치mica</option>
            <option value="IP_FIJA">BAF IP Fija</option>
          </select>
        </div>
        <div class="option">
          <label for="internet-speed">Velocidad de Internet</label>
          <select id="internet-speed">
            <option value="no">No incluir</option>
            <option value="100">100 MB</option>
            <option value="300">300 MB</option>
            <option value="600">600 MB</option>
          </select>
        </div>
        <div class="option">
          <label for="add-tv">Servicio de TV</label>
          <select id="add-tv">
            <option value="no">No incluir</option>
            <option value="1">1 Deco</option>
            <option value="2">2 Decos</option>
            <option value="3">3 Decos</option>
          </select>
        </div>
      </div>

      <!-- Secci칩n de Portabilidad -->
      <div id="portability-section"></div>

      <button id="add-line-btn" class="add-line-btn">+ A침adir L칤nea M칩vil</button>

      <!-- Opciones de Pago -->
      <div class="card">
        <h2 class="card-title">Beneficios</h2>
        <div class="option">
          <label for="has-claro-abono">Descuento Abono Claro</label>
          <select id="has-claro-abono">
            <option value="no">No tiene</option>
            <option value="1">1 L칤nea</option>
            <option value="2">2 o m치s</option>
          </select>
        </div>
        <div class="payment-option">
          <label for="pack-futbol-checkbox">A침adir Pack F칰tbol</label>
          <label class="toggle-switch">
            <input type="checkbox" id="pack-futbol-checkbox" />
            <span class="slider"></span>
          </label>
        </div>
        <div class="payment-option">
          <label for="claro-pay-checkbox">Pagar con Claro Pay</label>
          <label class="toggle-switch">
            <input type="checkbox" id="claro-pay-checkbox" />
            <span class="slider"></span>
          </label>
        </div>
      </div>

      <!-- Card de Total -->
      <div class="total-card">
        <div id="price-breakdown"></div>
        <hr class="total-separator" style="display: none;" />
        <div class="total-final">
          <h2>Total Mensual</h2>
          <p id="total-price">$0.00</p>
        </div>

        <!-- Action buttons -->
        <div class="action-buttons">
          <button id="copy-summary-btn" class="copy-btn" aria-label="Copiar resumen">游늶 Copiar</button>
          <button id="export-pdf-btn" class="copy-btn" aria-label="Exportar a PDF">游늯 PDF</button>
          <button id="toggle-chart-btn" class="copy-btn" aria-label="Mostrar/ocultar gr치fico">游늵 Gr치fico</button>
        </div>

        <!-- Chart container (hidden by default) -->
        <div id="chart-container" class="chart-container" style="display: none;">
          <canvas id="cost-chart" aria-label="Gr치fico de distribuci칩n de costos"></canvas>
        </div>
      </div>
    </main>

    <!-- Tab: Carga de Cliente -->
    <section id="tab-carga" class="tab-content" role="tabpanel" hidden>
      <div class="carga-section">
        <h2 class="section-title">Carga de Cliente</h2>
        <p class="section-subtitle">Selecciona un formulario para cargar un nuevo cliente</p>

        <div id="carga-buttons" class="carga-buttons">
          <!-- Los botones se cargan din치micamente desde links.json -->
        </div>
      </div>
    </section>

    <!-- Navigation Tabs (Bottom) -->
    <nav class="tabs-nav" role="tablist">
      <button class="tab-btn active" data-tab="calculadora" role="tab" aria-selected="true">
        游빑 Calculadora
      </button>
      <button class="tab-btn" data-tab="carga" role="tab" aria-selected="false">
        游늶 Carga
      </button>
    </nav>

  </div>

  <!-- Modal for configuration -->
  <div id="config-modal" class="modal">
    <div class="modal-content">
      <header class="modal-header">
        <h2>Configuraci칩n de Precios</h2>
        <span class="close-btn">&times;</span>
      </header>
      <div id="validation-error" style="display: none;"></div>
      <textarea id="json-editor" spellcheck="false"></textarea>
      <div class="modal-actions">
        <button id="format-json-btn" class="secondary-btn">Formatear</button>
        <button id="save-config-btn">Guardar Cambios</button>
      </div>
    </div>
  </div>

  <script type="module" src="script.js"></script>
  <script>
    // Register Service Worker for PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(reg => console.log('SW registrado:', reg.scope))
          .catch(err => console.log('SW error:', err));
      });
    }
  </script>
</body>

</html>